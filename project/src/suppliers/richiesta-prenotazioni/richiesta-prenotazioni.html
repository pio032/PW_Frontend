<div class="richiesta-prenotazioni-container">
  <h1>Richiedi una Prenotazione</h1>

  <form class="prenotazione-form">

    <!-- Sezione Data -->
    <div class="form-group">
      <label for="data">Data: <span class="required">*</span></label>
      <input
        type="date"
        id="data"
        [value]="selectedDate"
        (change)="onDateChange($event)"
        required>
    </div>

    <!-- Sezione Orario -->
    <div class="form-group">
      <label for="orario">Orario: <span class="required">*</span></label>
      <input
        type="time"
        id="orario"
        [value]="selectedTime"
        (change)="onTimeChange($event)"
        required>
    </div>

    <!-- Sezione Note Opzionali -->
    <div class="form-group">
      <label for="note">Note (opzionale):</label>
      <textarea
        id="note"
        rows="4"
        cols="50"
        placeholder="Inserisci eventuali note aggiuntive..."
        [value]="notes"
        (input)="onNotesChange($event)"></textarea>
    </div>

    <!-- Sezione Foto -->
    <div class="form-group">
      <label>Foto richiesta <span class="required">*</span></label>

      <!-- Selezione file -->
      <div class="photo-section">
        <input
          type="file"
          #fileInput
          accept="image/*"
          (change)="onFileSelected($event)"
          style="display: none;">

        <button
          type="button"
          class="btn-secondary"
          (click)="fileInput.click()">
          üìÅ Carica File
        </button>

        <button
          type="button"
          class="btn-secondary"
          (click)="startCamera()"
          [disabled]="isCameraActive">
          üì∑ Avvia Fotocamera
        </button>
      </div>

      <!-- Anteprima file selezionato -->
      <div *ngIf="selectedFile" class="image-preview">
        <p>File selezionato: {{selectedFile.name}}</p>
        <button
          type="button"
          class="btn-danger"
          (click)="removeImage()">
          ‚ùå Rimuovi
        </button>
      </div>

      <!-- Sezione fotocamera -->
      <div *ngIf="isCameraActive" class="camera-section">
        <video #videoElement autoplay playsinline></video>
        <canvas #canvasElement style="display: none;"></canvas>
        <div class="camera-controls">
          <button
            type="button"
            class="btn-primary"
            (click)="capturePhoto()">
            üì∏ Scatta Foto
          </button>
          <button
            type="button"
            class="btn-secondary"
            (click)="stopCamera()">
            ‚ùå Chiudi Fotocamera
          </button>
        </div>
      </div>

      <!-- Anteprima foto scattata -->
      <div *ngIf="capturedImage" class="image-preview">
        <p>Foto scattata:</p>
        <img [src]="capturedImage" alt="Foto scattata" style="max-width: 200px; max-height: 200px;">
        <button
          type="button"
          class="btn-danger"
          (click)="removeImage()">
          ‚ùå Rimuovi
        </button>
      </div>
    </div>

    <!-- Sezione Bolla dell'Ordine -->
    <div class="form-group">
      <label>Bolla dell'ordine <span class="required">*</span></label>

      <!-- Selezione file bolla -->
      <div class="photo-section">
        <input
          type="file"
          #bollaInput
          accept="image/*,.pdf,.doc,.docx"
          (change)="onBollaSelected($event)"
          style="display: none;">

        <button
          type="button"
          class="btn-secondary"
          (click)="bollaInput.click()">
          üìÑ Carica Bolla
        </button>
      </div>

      <!-- Anteprima bolla selezionata -->
      <div *ngIf="selectedBolla" class="image-preview">
        <p>Bolla caricata: {{selectedBolla.name}}</p>
        <div *ngIf="bollaImagePreview" class="bolla-preview">
          <img [src]="bollaImagePreview" alt="Anteprima bolla" style="max-width: 200px; max-height: 200px;">
        </div>
        <div *ngIf="!bollaImagePreview && selectedBolla" class="file-icon">
          üìÑ {{getFileIcon(selectedBolla.type)}} {{selectedBolla.name}}
        </div>
        <button
          type="button"
          class="btn-danger"
          (click)="removeBolla()">
          ‚ùå Rimuovi Bolla
        </button>
      </div>
    </div>

    <!-- Messaggio di errore -->
    <div *ngIf="!isFormValid" class="error-message">
      <p>‚ö†Ô∏è Compila tutti i campi obbligatori: data, orario, foto e bolla dell'ordine.</p>
    </div>

    <!-- Pulsante di invio -->
    <div class="form-actions">
      <button
        type="button"
        class="btn-primary btn-submit"
        [disabled]="!isFormValid"
        (click)="inviaRichiesta()">
        Invia Richiesta
      </button>
    </div>

  </form>
</div>
